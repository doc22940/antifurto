<html>
    <head>
        <link rel="stylesheet" type="text/css" href="styles.css" />
        <title>Antifurto</title>
    </head>

    <body>
        <h1>Antifurto</h1>
        
        This is Antifurto by berta.

        <h2>Live view</h2>

        <div id='cmdresult'></div>
        <div>
            <img id='liveimg' src='' width=640 height=480>
        </div>

        <script type='text/javascript'>
            var counter = 0;

            function loadImage(url, imageObj, target) {
                imageObj.onload = function() {
                    target.setAttribute('src', this.src);
                    loadImage(url, imageObj, target);
                };
                imageObj.src = url + '?t=' + counter++;
            }

            function startupRequest(outDiv, onSuccess) {
                var request = new XMLHttpRequest();
                request.open('GET', 'controller/live.php', true);
                request.onload = function() {
                    response = JSON.parse(this.responseText);
                    // response is { result: int, log: string }
                    var out = document.getElementById(outDiv);
                    if (response.result == 0)
                        onSuccess();
                    else {
                        out.innerHTML = 'Error executing command';
                        console.log(response.log);
                    }
                }
                request.send();
            }

            startupRequest('cmdresult', function() {
                var img = document.getElementById('liveimg');
                loadImage('live/live.jpg', img, new Image);
            });
        </script>

    </body>
</html>
